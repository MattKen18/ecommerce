{% extends 'store/main.html' %}
{% load static %}
{% block title %} MyCart {% endblock %}
{% block active %}
  <div class="form-inline right left-content mr-auto">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="{% url 'store' %}">Store</a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" href="{% url 'cart' %}">Cart<span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'shipping' %}">Checkout</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'sellerhome' %}">Sell</a>
      </li>
    </ul>
  </div>
{% endblock active %}
{% block content %}

<script type="text/javascript">

  function reload() {
    location.reload()
  }

</script>

{% if messages %}
{% for message in messages %}
  <p id="message">{{ message }}</p>
{% endfor %}
{% endif %}
<br>
<br>

<div class="row row-heading element-container">
  <div class="col-lg-4 cart-btn cart-go-back">
    <a class="btn btn-outline-secondary cart-heading" href="{% url 'store' %}">Continue Shopping</a>
  </div>
  <div class="col-lg-4 cart-total">
    <p>Cart Total: ${{ total|floatformat:2 }} USD</p>
  </div>
  <div class="col-lg-4 cart-btn cart-go-to-checkout">
    <a class="btn btn-outline-primary cart-heading" href="{% url 'shipping' %}"><p>Checkout</p></a>
  </div>
</div>
<hr>
<div class="row cart-content">
  {% for item in cart%}
    <div class="element-container cart-item">
      <div class="cart-product product-image">
        <div class="product-image-holder">
          <img src="{{ item.product.imageURL }}" alt="">
        </div>
      </div>
      <div class="cart-product cdetail product-details">
        <div class="cart-product-name">
          <p>{{ item.product.name }}</p>
        </div>
        <div class="cart-product-price">
          <p>Price: <span class="cart-product-price-span">${{ item.product.price }} USD</span></p>
        </div>
      </div>
      <div class="cart-product cdetail product-quantity">
        <div class="chg-quantity-form-holder">
          <form id="input" class="form-inline my-2 my-lg-0 chg-quantity chg-form" action="{% url 'changeqty' item.id %}" method="post">
            {% csrf_token %}
            <input class="chg-quantity qty-input" type="number" name="item_quantity" value="{{ item.quantity }}" min="0"/>
            <span style="font-size: 20px;">/{{ item.product.amt_available }}</span>
            <a class="submit-qty-chg yes" type="submit" name="reload" onclick="reload()"><button type="submit"><i class="submit-qty-chg far fa-check-circle grow yes"></i></button></a>
            <a class="submit-qty-chg no" href="{% url 'deleteitem' item.id %}" title="Delete"><i class="submit-qty-chg far fa-times-circle grow no"></i></a>
          </form>
        </div>

      </div>
      <div class="cart-product cdetail product-price">
        <p>= ${{ item.total|floatformat:2 }} USD</p>
      </div>

    </div>
    <br>
  {% endfor %}
</div>
<!--
<div class="row">
  <div class="col-lg-12">
    <div class="box-element table-responsive">
      <a class= "btn btn-outline-secondary" onclick="history.back()">&#8592; Continue Shopping</a>
      <br>
      <hr>

      <table class='table'>
        <tr>
          <th>Items: {{ items }}</th>
          <th>Total: ${{ total|floatformat:2 }}</th>
          <th style="float: right;"><a class='btn btn-outline-success' href="{% url 'shipping' %}">Checkout</a></th>
        </tr>
      </table>
    </div>

    <br>

    <div class="box-element">
        <div class="cart-row heading-holder">
          <div class="cart-row-heading" style="flex: 1;"></div>
          <div class="cart-row-heading" style="flex: 2;"><strong>Item</strong></div>
          <div class="cart-row-heading" style="flex: 1;"><strong>Price</strong></div>
          <div class="cart-row-heading" style="flex: 1;"><strong>Quantity</strong></div>
          <div class="cart-row-heading" style="flex: 1;"><strong>Total</strong></div>
        </div>
        <hr>
        {% for item in cart %}
        <div class="cart-row item-row">
          <div class="cart-row item thumb-img" style="flex: 1;"><img class="item-thumb" src="{{ item.product.imageURL }}"></div>
          <div class="cart-row item product-text" style="flex: 2;"><p class="item-details name">{{ item }}</p></div>
          <div class="cart-row item product-price" style="flex: 1;"><p class="item-details price">${{ item.product.price|floatformat:2 }}</p></div>
          <div class="cart-row item product-quantity" style="flex: 1;">
            <form id="input" class="form-inline my-2 my-lg-0 chg-quantity chg-form" action="{% url 'changeqty' item.id %}" method="post">
              {% csrf_token %}
              <input class="chg-quantity qty-input" type="number" name="item_quantity" value="{{ item.quantity }}" />
              <a class="submit-qty-chg yes" type="submit" name="reload" onclick="reload()"><button type="submit"><i class="submit-qty-chg far fa-check-circle grow yes"></i></button></a>
              <a class="submit-qty-chg no" href="{% url 'deleteitem' item.id %}" title="Delete"><i class="submit-qty-chg far fa-times-circle grow no"></i></a>
            </form>
            <!--<p class="item-details item-amt">{{ item.quantity }}</p>
          </div>
          <div class="cart-row item product-total-price" style="flex: 1;"><p class="item-details total">${{ item.total|floatformat:2 }}</p></div>
        </div>
        <hr>
        {% endfor %}
    </div>

  </div>
</div>-->

<script type="text/javascript">
  var x = document.getElementsByClassName('submit-qty-chg');
  var i;
  for (i = 0; i < x.length; i++) {
    x[i].style.display = "none";
  }

  function show_submit() {
    var y = document.getElementsByClassName('submit-qty-chg');
    var j;
    for (j = 0; j < y.length; j++) {
      y[j].style.display = "block";
    }
  }


  document.querySelectorAll('.chg-form').forEach(item => {
    item.addEventListener('mouseover', event => {
      show_submit()
    })
  })

</script>

{% endblock content %}
